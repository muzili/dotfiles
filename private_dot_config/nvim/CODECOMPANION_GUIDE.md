# CodeCompanion.nvim å®Œæ•´ä½¿ç”¨æŒ‡å—

> ğŸ¤– AI é©±åŠ¨çš„ Neovim ç¼–ç¨‹åŠ©æ‰‹ - è®© AI æˆä¸ºä½ çš„ç¼–ç¨‹ä¼™ä¼´

## ğŸ“– ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
- [å¿«æ·é”®å‚è€ƒ](#å¿«æ·é”®å‚è€ƒ)
- [AI æä¾›å•†é…ç½®](#ai-æä¾›å•†é…ç½®)
- [é«˜çº§åŠŸèƒ½](#é«˜çº§åŠŸèƒ½)
- [å·¥ä½œæµå’Œè‡ªåŠ¨åŒ–](#å·¥ä½œæµå’Œè‡ªåŠ¨åŒ–)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [æ‰©å±•å’Œè‡ªå®šä¹‰](#æ‰©å±•å’Œè‡ªå®šä¹‰)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨æµç¨‹

1. **æ‰“å¼€ AI èŠå¤©**: `<leader>cc`
2. **é€‰æ‹©ä»£ç å¹¶è§£é‡Š**: é€‰ä¸­ä»£ç  â†’ `<leader>ce`
3. **ä»£ç é‡æ„**: é€‰ä¸­ä»£ç  â†’ `<leader>cr`
4. **ç”Ÿæˆæµ‹è¯•**: é€‰ä¸­å‡½æ•° â†’ `<leader>ct`

### ç¬¬ä¸€æ¬¡ä½¿ç”¨

```bash
# 1. ç¡®ä¿ API å¯†é’¥å·²é…ç½®
:lua print(require("ai_config").list_providers())

# 2. æµ‹è¯•è¿æ¥
:CodeCompanionChat New

# 3. å‘é€æµ‹è¯•æ¶ˆæ¯
Hello, can you help me with coding?
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æ™ºèƒ½èŠå¤© (Chat)

**åŠŸèƒ½**: ä¸ AI è¿›è¡Œè‡ªç„¶è¯­è¨€å¯¹è¯ï¼Œè·å–ç¼–ç¨‹å¸®åŠ©

**ä½¿ç”¨æ–¹å¼**:
- `<leader>cc` - åˆ‡æ¢èŠå¤©çª—å£
- `<leader>cn` - æ–°å»ºèŠå¤©ä¼šè¯
- `<leader>cC` - å°†é€‰ä¸­å†…å®¹æ·»åŠ åˆ°èŠå¤©

**èŠå¤©æŠ€å·§**:
```
# æœ‰æ•ˆçš„æé—®æ–¹å¼
"è¿™æ®µä»£ç æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ" + ä»£ç å—
"å¦‚ä½•ä¼˜åŒ–è¿™ä¸ªç®—æ³•çš„æ€§èƒ½ï¼Ÿ"
"å¸®æˆ‘è®¾è®¡ä¸€ä¸ªç”¨æˆ·è®¤è¯ç³»ç»Ÿçš„æ¶æ„"
"è§£é‡Šä¸€ä¸‹è¿™ä¸ªè®¾è®¡æ¨¡å¼çš„åº”ç”¨åœºæ™¯"

# ä¸Šä¸‹æ–‡å¢å¼º
/buffer - åŒ…å«å½“å‰ç¼“å†²åŒºå†…å®¹
/file path/to/file.js - åŒ…å«æŒ‡å®šæ–‡ä»¶
/symbols - åŒ…å«å½“å‰æ–‡ä»¶çš„ç¬¦å·ä¿¡æ¯
```

### 2. è¡Œå†…åŠ©æ‰‹ (Inline)

**åŠŸèƒ½**: ç›´æ¥åœ¨ä»£ç ä¸­ç”Ÿæˆã€ä¿®æ”¹æˆ–è¡¥å…¨å†…å®¹

**ä½¿ç”¨æ–¹å¼**:
- `<leader>ci` - æ¿€æ´»è¡Œå†…åŠ©æ‰‹
- é€‰ä¸­ä»£ç  + `<leader>cr` - è¡Œå†…é‡æ„
- é€‰ä¸­ä»£ç  + `<leader>cf` - è¡Œå†…ä¿®å¤

**è¡Œå†…æ“ä½œç¤ºä¾‹**:
```lua
-- 1. é€‰ä¸­è¿™ä¸ªå‡½æ•°
function calculateTotal(items) {
  -- å…‰æ ‡åœ¨è¿™é‡Œï¼ŒæŒ‰ <leader>ci
  -- è¾“å…¥: "å®ç°è®¡ç®—æ€»ä»·çš„é€»è¾‘ï¼ŒåŒ…å«ç¨è´¹è®¡ç®—"
}

-- 2. AI ä¼šç›´æ¥åœ¨å‡½æ•°å†…ç”Ÿæˆä»£ç 
function calculateTotal(items) {
  let subtotal = items.reduce((sum, item) => sum + item.price, 0);
  let tax = subtotal * 0.08; // 8% ç¨ç‡
  return subtotal + tax;
}
```

### 3. åŠ¨ä½œé¢æ¿ (Actions)

**åŠŸèƒ½**: å¿«é€Ÿè®¿é—®é¢„å®šä¹‰çš„ AI æ“ä½œ

**ä½¿ç”¨æ–¹å¼**:
- `<leader>ca` - æ‰“å¼€åŠ¨ä½œé¢æ¿
- é€‰æ‹©æ“ä½œå¹¶æ‰§è¡Œ

**å¯ç”¨åŠ¨ä½œ**:
- ğŸ“ **Explain** - è§£é‡Šä»£ç é€»è¾‘
- ğŸ”§ **Refactor** - é‡æ„ä»£ç ç»“æ„
- ğŸ“š **Document** - ç”Ÿæˆæ–‡æ¡£æ³¨é‡Š
- ğŸ§ª **Tests** - ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹
- ğŸ› **Fix** - ä¿®å¤ä»£ç é—®é¢˜
- âš¡ **Optimize** - æ€§èƒ½ä¼˜åŒ–

## âŒ¨ï¸ å¿«æ·é”®å‚è€ƒ

### ä¸»è¦å¿«æ·é”®

| å¿«æ·é”® | æ¨¡å¼ | åŠŸèƒ½ | æè¿° |
|--------|------|------|------|
| `<leader>ca` | n,v | AI Actions | æ‰“å¼€åŠ¨ä½œé¢æ¿ |
| `<leader>cc` | n,v | Chat Toggle | åˆ‡æ¢èŠå¤©çª—å£ |
| `<leader>ci` | n,v | Inline | è¡Œå†… AI åŠ©æ‰‹ |
| `<leader>cn` | n | New Chat | æ–°å»ºèŠå¤©ä¼šè¯ |
| `<leader>cC` | v | Add to Chat | æ·»åŠ åˆ°èŠå¤© |

### å¿«é€Ÿæ“ä½œ

| å¿«æ·é”® | æ¨¡å¼ | åŠŸèƒ½ | æè¿° |
|--------|------|------|------|
| `<leader>ce` | n,v | Explain | è§£é‡Šä»£ç  |
| `<leader>cr` | n,v | Refactor | é‡æ„ä»£ç  |
| `<leader>cd` | n,v | Document | ç”Ÿæˆæ–‡æ¡£ |
| `<leader>ct` | n,v | Tests | ç”Ÿæˆæµ‹è¯• |
| `<leader>cf` | n,v | Fix | ä¿®å¤ä»£ç  |
| `<leader>co` | n,v | Optimize | ä¼˜åŒ–ä»£ç  |

### å·¥ä½œæµå¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ | æè¿° |
|--------|------|------|
| `<leader>cwr` | Code Review | å®Œæ•´ä»£ç å®¡æŸ¥ |
| `<leader>cwb` | Bug Analysis | Bug åˆ†ææµç¨‹ |

### èŠå¤©çª—å£å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ | æè¿° |
|--------|------|------|
| `<C-c>` | åœæ­¢ç”Ÿæˆ | ä¸­æ–­ AI å“åº” |
| `<C-s>` | ä¿å­˜èŠå¤© | ä¿å­˜å½“å‰ä¼šè¯ |
| `q` | å…³é—­çª—å£ | å…³é—­èŠå¤©çª—å£ |

## ğŸ”§ AI æä¾›å•†é…ç½®

### æ”¯æŒçš„æä¾›å•†

1. **æ™ºè°± AI (Zhipu)** - ä¸»è¦æä¾›å•† âœ…
   - æ¨¡å‹: `glm-4.5-flash`, `glm-4-flash`, `glm-4`, `glm-4-plus`
   - ç‰¹ç‚¹: ä¸­æ–‡ä¼˜åŒ–ï¼Œå“åº”å¿«é€Ÿï¼Œå·²å®Œå…¨é…ç½®

2. **ç™¾ç‚¼ AI (Bailian)** - å¤‡ç”¨æä¾›å•†
   - æ¨¡å‹: `qwen-turbo`, `qwen-plus`, `qwen-max`
   - ç‰¹ç‚¹: é˜¿é‡Œäº‘æœåŠ¡ï¼Œç¨³å®šå¯é 

3. **OpenAI** - å›½é™…æ ‡å‡†
   - æ¨¡å‹: `gpt-4`, `gpt-3.5-turbo`
   - ç‰¹ç‚¹: åŠŸèƒ½å…¨é¢ï¼Œè´¨é‡é«˜

4. **Anthropic Claude** - é«˜è´¨é‡å¯¹è¯
   - æ¨¡å‹: `claude-3-sonnet`, `claude-3-haiku`
   - ç‰¹ç‚¹: å®‰å…¨æ€§é«˜ï¼Œæ¨ç†èƒ½åŠ›å¼º

5. **Ollama** - æœ¬åœ°éƒ¨ç½²
   - æ¨¡å‹: `codellama`, `llama2`, `mistral`
   - ç‰¹ç‚¹: éšç§ä¿æŠ¤ï¼Œæ— ç½‘ç»œä¾èµ–

### é…ç½®ä¼˜å…ˆçº§

ç³»ç»ŸæŒ‰ä»¥ä¸‹é¡ºåºé€‰æ‹©æä¾›å•†ï¼š
1. æ™ºè°± AI (å¦‚æœå·²é…ç½®)
2. ç™¾ç‚¼ AI (å¦‚æœå·²é…ç½®)
3. OpenAI (å¦‚æœå·²é…ç½®)
4. å…¶ä»–æä¾›å•†

### API å¯†é’¥é…ç½®

#### æ–¹æ³• 1: ç¯å¢ƒå˜é‡ (æ¨è)
```bash
export ZHIPU_API_KEY="your-zhipu-key"
export BAILIAN_API_KEY="your-bailian-key"
export OPENAI_API_KEY="your-openai-key"
```

#### æ–¹æ³• 2: GPG åŠ å¯†æ–‡ä»¶
```bash
# åŠ å¯†å­˜å‚¨ API å¯†é’¥
echo "your-api-key" | gpg --armor --encrypt -r your-gpg-id > ~/.zhipu.gpg
```

#### æ–¹æ³• 3: é…ç½®æ–‡ä»¶
```lua
-- åœ¨ lua/ai_config.lua ä¸­ç›´æ¥é…ç½®
M.config = {
  zhipu = {
    api_key = "your-zhipu-key",
    -- ...
  }
}
```

## ğŸ¨ é«˜çº§åŠŸèƒ½

### 1. Slash Commands (æ–œæ å‘½ä»¤)

åœ¨èŠå¤©ä¸­ä½¿ç”¨æ–œæ å‘½ä»¤å¢å¼ºä¸Šä¸‹æ–‡ï¼š

```
/buffer          # åŒ…å«å½“å‰ç¼“å†²åŒºå†…å®¹
/file src/main.js # åŒ…å«æŒ‡å®šæ–‡ä»¶
/symbols         # åŒ…å«å½“å‰æ–‡ä»¶çš„ç¬¦å·
/help vim        # åŒ…å« Vim å¸®åŠ©å†…å®¹
/now             # åŒ…å«å½“å‰æ—¶é—´
```

**ä½¿ç”¨ç¤ºä¾‹**:
```
ç”¨æˆ·: /buffer è¯·å¸®æˆ‘é‡æ„è¿™ä¸ªæ–‡ä»¶çš„ä»£ç ç»“æ„
AI: æˆ‘çœ‹åˆ°ä½ çš„ä»£ç æ–‡ä»¶åŒ…å«ä»¥ä¸‹å†…å®¹... [åˆ†æå¹¶æä¾›é‡æ„å»ºè®®]
```

### 2. Variables (å˜é‡)

åœ¨æç¤ºä¸­ä½¿ç”¨å˜é‡è·å–åŠ¨æ€ä¿¡æ¯ï¼š

```
${buffer}        # å½“å‰ç¼“å†²åŒºå†…å®¹
${selection}     # é€‰ä¸­çš„æ–‡æœ¬
${filetype}      # æ–‡ä»¶ç±»å‹
${filename}      # æ–‡ä»¶å
${line_number}   # å½“å‰è¡Œå·
```

### 3. è‡ªå®šä¹‰æç¤ºæ¨¡æ¿

```lua
-- åœ¨é…ç½®ä¸­æ·»åŠ è‡ªå®šä¹‰æç¤º
prompt_library = {
  ["My Prompts"] = {
    ["API Documentation"] = {
      strategy = "chat",
      description = "ç”Ÿæˆ API æ–‡æ¡£",
      prompts = {
        {
          role = "system",
          content = "ä½ æ˜¯ä¸€ä¸ª API æ–‡æ¡£ä¸“å®¶..."
        },
        {
          role = "user", 
          content = function(context)
            return "ä¸ºä»¥ä¸‹ API ç”Ÿæˆæ–‡æ¡£ï¼š\n" .. context.selection
          end
        }
      }
    }
  }
}
```

### 4. å¤šä¼šè¯ç®¡ç†

- **å¹¶è¡Œä¼šè¯**: å¯ä»¥åŒæ—¶æ‰“å¼€å¤šä¸ªèŠå¤©çª—å£
- **ä¼šè¯ä¿å­˜**: è‡ªåŠ¨ä¿å­˜èŠå¤©å†å²
- **ä¸Šä¸‹æ–‡éš”ç¦»**: æ¯ä¸ªä¼šè¯ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡

```vim
:CodeCompanionChat New      " æ–°å»ºä¼šè¯
:CodeCompanionChat Toggle   " åˆ‡æ¢å½“å‰ä¼šè¯
:CodeCompanionChat Close    " å…³é—­å½“å‰ä¼šè¯
```

### 5. è§†è§‰è¾“å…¥æ”¯æŒ

æ”¯æŒå°†å›¾ç‰‡ä½œä¸ºè¾“å…¥ï¼š

```vim
" é€‰æ‹©å›¾ç‰‡æ–‡ä»¶å¹¶å‘é€ç»™ AI
:CodeCompanionChat Add /path/to/image.png
```

## ğŸ”„ å·¥ä½œæµå’Œè‡ªåŠ¨åŒ–

### é¢„å®šä¹‰å·¥ä½œæµ

#### 1. ä»£ç å®¡æŸ¥å·¥ä½œæµ
```
<leader>cwr â†’ è§¦å‘å®Œæ•´ä»£ç å®¡æŸ¥
åŒ…æ‹¬ï¼š
- ä»£ç è´¨é‡åˆ†æ
- æ€§èƒ½è¯„ä¼°  
- å®‰å…¨æ£€æŸ¥
- æœ€ä½³å®è·µå»ºè®®
```

#### 2. Bug åˆ†æå·¥ä½œæµ
```
<leader>cwb â†’ è§¦å‘ Bug åˆ†æ
åŒ…æ‹¬ï¼š
- é—®é¢˜è¯Šæ–­
- æ ¹å› åˆ†æ
- ä¿®å¤å»ºè®®
- é¢„é˜²æªæ–½
```

### è‡ªå®šä¹‰å·¥ä½œæµ

```lua
workflows = {
  ["Performance Audit"] = {
    strategy = "chat",
    description = "æ€§èƒ½å®¡è®¡æµç¨‹",
    prompts = {
      -- å¤šæ­¥éª¤æç¤ºåºåˆ—
      { role = "system", content = "æ€§èƒ½åˆ†æä¸“å®¶..." },
      { role = "user", content = "åˆ†æä»£ç æ€§èƒ½..." },
      -- å¯ä»¥åŒ…å«å¤šä¸ªæ­¥éª¤
    }
  }
}
```

### è‡ªåŠ¨åŒ–è§¦å‘å™¨

```lua
-- åŸºäºæ–‡ä»¶ç±»å‹çš„è‡ªåŠ¨æç¤º
vim.api.nvim_create_autocmd("BufWritePre", {
  pattern = "*.js,*.ts",
  callback = function()
    -- ä¿å­˜å‰è‡ªåŠ¨æ£€æŸ¥ä»£ç è´¨é‡
    vim.cmd("CodeCompanionActions lint")
  end
})
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æœ‰æ•ˆçš„æé—®æŠ€å·§

#### âœ… å¥½çš„æé—®æ–¹å¼
```
"è¿™ä¸ªå‡½æ•°çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿå¦‚ä½•ä¼˜åŒ–ï¼Ÿ"
"å¸®æˆ‘è®¾è®¡ä¸€ä¸ªç¼“å­˜ç­–ç•¥æ¥æé«˜è¿™ä¸ª API çš„æ€§èƒ½"
"è¿™æ®µä»£ç æœ‰ä»€ä¹ˆæ½œåœ¨çš„å®‰å…¨é—®é¢˜ï¼Ÿ"
"å¦‚ä½•è®©è¿™ä¸ªç»„ä»¶æ›´ç¬¦åˆ React æœ€ä½³å®è·µï¼Ÿ"
```

#### âŒ é¿å…çš„æé—®æ–¹å¼
```
"è¿™ä¸ªä»£ç æ€ä¹ˆæ ·ï¼Ÿ"  # å¤ªæ¨¡ç³Š
"å¸®æˆ‘å†™ä»£ç "        # ç¼ºä¹å…·ä½“éœ€æ±‚
"ä¿®å¤è¿™ä¸ª"          # æ²¡æœ‰è¯´æ˜é—®é¢˜
```

### 2. ä¸Šä¸‹æ–‡ç®¡ç†

#### æä¾›å……åˆ†ä¸Šä¸‹æ–‡
```
# åŒ…å«ç›¸å…³æ–‡ä»¶
/file src/utils.js
/file src/types.ts

# è¯´æ˜ä¸šåŠ¡èƒŒæ™¯
"è¿™æ˜¯ä¸€ä¸ªç”µå•†ç³»ç»Ÿçš„è®¢å•å¤„ç†æ¨¡å—..."

# æŒ‡å®šçº¦æŸæ¡ä»¶
"éœ€è¦å…¼å®¹ IE11ï¼Œä¸èƒ½ä½¿ç”¨ ES6+ è¯­æ³•"
```

#### åˆ†æ­¥éª¤å¤„ç†å¤æ‚é—®é¢˜
```
1. å…ˆåˆ†æé—®é¢˜: "åˆ†æè¿™ä¸ªæ€§èƒ½ç“¶é¢ˆçš„åŸå› "
2. å†å¯»æ±‚æ–¹æ¡ˆ: "åŸºäºåˆ†æç»“æœï¼Œæä¾›ä¼˜åŒ–æ–¹æ¡ˆ"
3. æœ€åå®æ–½: "å¸®æˆ‘å®ç°æ¨èçš„ä¼˜åŒ–æ–¹æ¡ˆ"
```

### 3. ä»£ç è´¨é‡ä¿è¯

#### ä½¿ç”¨ä»£ç å®¡æŸ¥å·¥ä½œæµ
```bash
# é€‰ä¸­ä»£ç å
<leader>cwr  # è§¦å‘å®Œæ•´å®¡æŸ¥æµç¨‹
```

#### æ¸è¿›å¼é‡æ„
```bash
# ä¸è¦ä¸€æ¬¡æ€§é‡æ„æ•´ä¸ªæ–‡ä»¶
# é€‰æ‹©å°çš„ä»£ç å—é€æ­¥é‡æ„
1. é€‰ä¸­ä¸€ä¸ªå‡½æ•° â†’ <leader>cr
2. éªŒè¯é‡æ„ç»“æœ
3. ç»§ç»­ä¸‹ä¸€ä¸ªå‡½æ•°
```

### 4. å›¢é˜Ÿåä½œ

#### ç»Ÿä¸€æç¤ºæ¨¡æ¿
```lua
-- å›¢é˜Ÿå…±äº«çš„æç¤ºåº“
prompt_library = {
  ["Team Standards"] = {
    ["Code Review"] = {
      -- ç»Ÿä¸€çš„ä»£ç å®¡æŸ¥æ ‡å‡†
    },
    ["Documentation"] = {
      -- ç»Ÿä¸€çš„æ–‡æ¡£æ ¼å¼
    }
  }
}
```

#### é…ç½®æ ‡å‡†åŒ–
```bash
# ä½¿ç”¨å›¢é˜Ÿç»Ÿä¸€çš„é…ç½®æ–‡ä»¶
git clone team-nvim-config
ln -s team-nvim-config/codecompanion.lua ~/.config/nvim/lua/plugins/
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 0. é…ç½®æ ¼å¼é—®é¢˜ (å·²ä¿®å¤)
```bash
# å¦‚æœçœ‹åˆ°å¼ƒç”¨è­¦å‘Šï¼Œè¯·æ›´æ–°é…ç½®æ ¼å¼
# æ—§æ ¼å¼ (ä¼šæ˜¾ç¤ºè­¦å‘Š):
adapters = { zhipu = {...} }

# æ–°æ ¼å¼ (æ¨è):
adapters = { 
  http = { 
    zhipu = {...},
    opts = {...}
  } 
}
```

#### 1. é€‰ä¸­æ–‡æœ¬æ— æ³•ä¼ é€’ç»™ AI (å·²ä¿®å¤)
```lua
-- é—®é¢˜: ä½¿ç”¨äº†é”™è¯¯çš„æ¨¡æ¿è¯­æ³• {{selection}}
-- è§£å†³: ä½¿ç”¨å‡½æ•°å½¢å¼æ­£ç¡®è·å–é€‰ä¸­æ–‡æœ¬
content = function(context)
  local code = context.lines and table.concat(context.lines, "\n") or "å½“å‰ä»£ç "
  return "è¯·è§£é‡Šä»¥ä¸‹ä»£ç :\n\n```" .. (context.filetype or "") .. "\n" .. code .. "\n```"
end
```

#### 2. API å¯†é’¥é—®é¢˜
```bash
# æ£€æŸ¥å¯†é’¥é…ç½®
:lua print(vim.inspect(require("ai_config").list_providers()))

# æµ‹è¯•è¿æ¥
:lua require("ai_config").is_configured("zhipu")

# æ£€æŸ¥æ™ºè°± API å¯†é’¥
echo $ZHIPU_API_KEY
```

#### 3. è¿æ¥åˆ°é”™è¯¯çš„æœåŠ¡å™¨ (å·²ä¿®å¤)
```bash
# é—®é¢˜: è¿æ¥åˆ° localhost:11434 è€Œä¸æ˜¯æ™ºè°±æœåŠ¡å™¨
# åŸå› : è‡ªåŠ¨é€‚é…å™¨æ£€æµ‹å¯¼è‡´
# è§£å†³: æ·»åŠ  auto_adapters = false é…ç½®
```

#### 4. ç½‘ç»œè¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
curl -I https://open.bigmodel.cn/api/paas/v4/chat/completions

# ä½¿ç”¨ä»£ç† (å¦‚æœéœ€è¦)
export https_proxy=http://proxy:8080
```

#### 3. æ’ä»¶åŠ è½½é—®é¢˜
```vim
" æ£€æŸ¥æ’ä»¶çŠ¶æ€
:Lazy

" é‡æ–°åŠ è½½é…ç½®
:lua package.loaded["codecompanion"] = nil
:lua require("codecompanion").setup()
```

#### 4. æ€§èƒ½é—®é¢˜
```lua
-- å¯ç”¨è°ƒè¯•æ—¥å¿—
require("codecompanion").setup({
  log_level = "DEBUG"
})

-- æŸ¥çœ‹æ—¥å¿—
:lua print(vim.fn.stdpath("log") .. "/codecompanion.log")
```

### è°ƒè¯•æŠ€å·§

#### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—
```lua
opts = {
  log_level = "TRACE",  -- æœ€è¯¦ç»†çš„æ—¥å¿—
}
```

#### 2. æ£€æŸ¥é€‚é…å™¨çŠ¶æ€
```vim
:lua print(vim.inspect(require("codecompanion").get_adapters()))
```

#### 3. æµ‹è¯•æœ€å°é…ç½®
```lua
-- minimal.lua
require("codecompanion").setup({
  adapters = {
    openai = {
      api_key = "test-key"
    }
  }
})
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. å“åº”é€Ÿåº¦ä¼˜åŒ–

#### é€‰æ‹©åˆé€‚çš„æ¨¡å‹
```lua
adapters = {
  http = {
    zhipu = {
      model = "glm-4.5-flash",  -- æœ€æ–°æœ€å¿«çš„å“åº”
      temperature = 0.1,        -- æ›´ç¡®å®šçš„è¾“å‡º  
      max_tokens = 4000,        -- é™åˆ¶è¾“å‡ºé•¿åº¦
    },
    opts = {
      allow_insecure = false,
      show_defaults = false,    -- ä¸æ˜¾ç¤ºé»˜è®¤é€‚é…å™¨
    },
  }
}
```

#### ä½¿ç”¨æœ¬åœ°æ¨¡å‹
```lua
adapters = {
  ollama = {
    model = "codellama:7b",  -- è¾ƒå°çš„æ¨¡å‹
    endpoint = "http://localhost:11434"
  }
}
```

### 2. å†…å­˜ä½¿ç”¨ä¼˜åŒ–

#### é™åˆ¶èŠå¤©å†å²
```lua
chat = {
  max_history = 50,        -- é™åˆ¶å†å²æ¶ˆæ¯æ•°é‡
  auto_save = false,       -- ç¦ç”¨è‡ªåŠ¨ä¿å­˜
}
```

#### æ‡’åŠ è½½é…ç½®
```lua
{
  "olimorris/codecompanion.nvim",
  lazy = true,
  cmd = { "CodeCompanion", "CodeCompanionChat" },
  keys = { "<leader>cc", "<leader>ca" },
}
```

### 3. ç½‘ç»œä¼˜åŒ–

#### è¿æ¥æ± é…ç½®
```lua
adapters = {
  zhipu = {
    timeout = 30,           -- è¿æ¥è¶…æ—¶
    retry_count = 3,        -- é‡è¯•æ¬¡æ•°
    keep_alive = true,      -- ä¿æŒè¿æ¥
  }
}
```

#### ç¼“å­˜ç­–ç•¥
```lua
opts = {
  cache_enabled = true,     -- å¯ç”¨å“åº”ç¼“å­˜
  cache_ttl = 3600,        -- ç¼“å­˜æ—¶é—´ (ç§’)
}
```

## ğŸ›ï¸ æ‰©å±•å’Œè‡ªå®šä¹‰

### 1. è‡ªå®šä¹‰é€‚é…å™¨

```lua
-- æ·»åŠ æ–°çš„ AI æä¾›å•†
adapters = {
  custom_provider = function()
    return require("codecompanion.adapters").extend("openai_compatible", {
      name = "custom",
      url = "https://api.custom.com/v1/chat/completions",
      env = {
        api_key = "CUSTOM_API_KEY"
      },
      schema = {
        model = {
          default = "custom-model",
          choices = { "model-1", "model-2" }
        }
      }
    })
  end
}
```

### 2. è‡ªå®šä¹‰å‘½ä»¤

```lua
-- æ·»åŠ è‡ªå®šä¹‰ Vim å‘½ä»¤
vim.api.nvim_create_user_command("AIExplain", function()
  vim.cmd("CodeCompanionActions explain")
end, { range = true })

vim.api.nvim_create_user_command("AIRefactor", function()
  vim.cmd("CodeCompanionActions refactor") 
end, { range = true })
```

### 3. é›†æˆå…¶ä»–æ’ä»¶

#### ä¸ Telescope é›†æˆ
```lua
-- åœ¨ Telescope ä¸­æœç´¢ AI æ“ä½œ
require("telescope").setup({
  extensions = {
    codecompanion = {
      theme = "dropdown",
      previewer = false,
    }
  }
})
```

#### ä¸ Which-key é›†æˆ
```lua
require("which-key").register({
  ["<leader>c"] = {
    name = "AI CodeCompanion",
    a = "Actions",
    c = "Chat",
    i = "Inline",
    e = "Explain",
    r = "Refactor",
    -- ...
  }
})
```

### 4. ä¸»é¢˜å’Œ UI è‡ªå®šä¹‰

```lua
-- è‡ªå®šä¹‰é«˜äº®ç»„
vim.api.nvim_set_hl(0, "CodeCompanionChatHeader", { 
  fg = "#7aa2f7", 
  bold = true 
})

-- è‡ªå®šä¹‰çª—å£æ ·å¼
display = {
  chat = {
    window = {
      border = "double",      -- è¾¹æ¡†æ ·å¼
      winblend = 15,         -- é€æ˜åº¦
      title = " ğŸ¤– AI Assistant ",
    }
  }
}
```

## ğŸ“š å­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [CodeCompanion.nvim GitHub](https://github.com/olimorris/codecompanion.nvim)
- [å®˜æ–¹æ–‡æ¡£ç«™ç‚¹](https://codecompanion.olimorris.dev)

### ç¤¾åŒºèµ„æº
- [Neovim AI è®¨è®º](https://www.reddit.com/r/neovim/search?q=AI)
- [é…ç½®ç¤ºä¾‹é›†åˆ](https://github.com/topics/neovim-ai)

### ç›¸å…³æ’ä»¶
- [copilot.vim](https://github.com/github/copilot.vim) - GitHub Copilot
- [ChatGPT.nvim](https://github.com/jackMort/ChatGPT.nvim) - ChatGPT é›†æˆ
- [avante.nvim](https://github.com/yetone/avante.nvim) - Cursor AI é£æ ¼

---

## ğŸ‰ ç»“è¯­

CodeCompanion.nvim æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ AI ç¼–ç¨‹åŠ©æ‰‹ï¼Œé€šè¿‡åˆç†çš„é…ç½®å’Œä½¿ç”¨ï¼Œå¯ä»¥æ˜¾è‘—æé«˜ç¼–ç¨‹æ•ˆç‡ã€‚è®°ä½ï¼š

1. **ä»ç®€å•å¼€å§‹** - å…ˆæŒæ¡åŸºæœ¬åŠŸèƒ½ï¼Œå†æ¢ç´¢é«˜çº§ç‰¹æ€§
2. **ä¿æŒä¸Šä¸‹æ–‡** - æä¾›æ¸…æ™°çš„é—®é¢˜æè¿°å’Œä»£ç ä¸Šä¸‹æ–‡
3. **è¿­ä»£æ”¹è¿›** - æ ¹æ®ä½¿ç”¨ä½“éªŒä¸æ–­è°ƒæ•´é…ç½®
4. **å®‰å…¨ç¬¬ä¸€** - å¦¥å–„ç®¡ç† API å¯†é’¥ï¼Œæ³¨æ„ä»£ç éšç§

Happy coding with AI! ğŸš€

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### 2025-09-17 - é…ç½®ä¿®å¤ä¸ä¼˜åŒ–

#### ğŸ”§ ä¿®å¤çš„é—®é¢˜
1. **é€‚é…å™¨é…ç½®å¼ƒç”¨è­¦å‘Š** - å°†é…ç½®è¿ç§»åˆ°æ–°æ ¼å¼ `adapters.http.*`
2. **é€‰ä¸­æ–‡æœ¬æ— æ³•ä¼ é€’** - ä¿®å¤æ‰€æœ‰å‘½ä»¤çš„ context è·å–é€»è¾‘
3. **è¿æ¥é”™è¯¯æœåŠ¡å™¨** - æ·»åŠ  `auto_adapters = false` é˜²æ­¢è‡ªåŠ¨æ£€æµ‹
4. **æ¨¡æ¿å˜é‡ä¸å·¥ä½œ** - å°† `{{selection}}` æ”¹ä¸ºå‡½æ•°å½¢å¼çš„ `context.lines`

#### âš¡ ä¼˜åŒ–æ”¹è¿›
1. **æ¨¡å‹å‡çº§** - ä½¿ç”¨æœ€æ–°çš„ `glm-4.5-flash` æ¨¡å‹
2. **é…ç½®æ ‡å‡†åŒ–** - ç»Ÿä¸€æ‰€æœ‰å‘½ä»¤çš„é…ç½®æ ¼å¼
3. **é”™è¯¯å¤„ç†** - æ·»åŠ æ›´å¥½çš„é”™è¯¯æç¤ºå’Œè°ƒè¯•ä¿¡æ¯
4. **æ–‡æ¡£æ›´æ–°** - æ›´æ–°æ•…éšœæ’é™¤å’Œæœ€ä½³å®è·µ

#### âœ… éªŒè¯é€šè¿‡çš„åŠŸèƒ½
- [x] `<leader>ce` - è§£é‡Šä»£ç  (Visual æ¨¡å¼é€‰ä¸­ä»£ç åæ­£å¸¸å·¥ä½œ)
- [x] `<leader>cr` - é‡æ„ä»£ç 
- [x] `<leader>cd` - ç”Ÿæˆæ–‡æ¡£
- [x] `<leader>ct` - ç”Ÿæˆæµ‹è¯•
- [x] `<leader>cf` - ä¿®å¤ä»£ç 
- [x] `<leader>co` - ä¼˜åŒ–ä»£ç 
- [x] æ™ºè°± AI è¿æ¥æ­£å¸¸
- [x] æ— é…ç½®è­¦å‘Šä¿¡æ¯